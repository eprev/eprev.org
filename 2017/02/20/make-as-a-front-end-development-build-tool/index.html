<!doctype html><html lang="en"><meta charset="utf-8"><title>Make as a front-end development build tool – Anton Eprev</title><link rel="shortcut icon" href="/assets/4-eyed-32x32.png"><link rel="preload" as="font" type="font/woff2" href="/assets/fonts/merriweathersans-light.woff2" crossorigin><link rel="preload" as="font" type="font/woff2" href="/assets/fonts/merriweathersans-bold.woff2" crossorigin><link rel="preload" as="font" type="font/woff2" href="/assets/fonts/merriweathersans-lightitalic.woff2" crossorigin><style>:root{color-scheme:light dark;--color:#222;--background-color:#fff;--underline-color:#ececec;--underline-hover-color:#d0e0f0;--meta-color:#757575;--code-color:#f9f9f9}@media (prefers-color-scheme:dark){:root{--color:#ccc;--background-color:#222;--underline-color:#444;--underline-hover-color:#666;--code-color:#202020;--image-filter:grayscale(30%)}img:not([src*=".svg"]){filter:var(--image-filter)}}body{margin:0}button,input,select,textarea{margin:0;font-size:100%;font-family:inherit}@font-face{font-weight:300;font-style:normal;font-family:Merriweather Sans;src:local("Merriweather Sans Light"),local("MerriweatherSans-Light"),url(/assets/fonts/merriweathersans-light.woff2) format("woff2");font-display:fallback}@font-face{font-weight:700;font-style:normal;font-family:Merriweather Sans;src:local("Merriweather Sans Bold"),local("MerriweatherSans-Bold"),url(/assets/fonts/merriweathersans-bold.woff2) format("woff2");font-display:fallback}@font-face{font-weight:300;font-style:italic;font-family:Merriweather Sans;src:local("Merriweather Sans Light Italic"),local("MerriweatherSans-LightItalic"),url(/assets/fonts/merriweathersans-lightitalic.woff2) format("woff2");font-display:fallback}html{font-size:16px;line-height:1.5}body{color:var(--color);background-color:var(--background-color);font-family:Merriweather Sans,Helvetica Neue,Segoe UI,Arial,sans-serif}body,h1,h2,h3,h4,h5,h6{font-weight:300}h1,h2,h3,h4,h5,h6{margin:0 0 1.5rem;page-break-inside:avoid;text-rendering:optimizeLegibility}h1{font-size:2rem}h1,h2{line-height:3rem}h2{font-size:1.75rem}h3{font-size:1.5rem}h3,h4{line-height:1.5rem}h4{font-size:1.3rem}h5{font-size:1.16rem}h5,h6{line-height:1.5rem}h6{font-size:1rem}blockquote,ol,p,pre,ul{margin:1.5rem 0}blockquote{padding-left:1.5rem;font-style:italic}blockquote.epigraph,ul{padding-left:0}ul{list-style-position:outside;list-style-type:square}p{-webkit-hyphens:auto;-ms-hyphens:auto;hyphens:auto}code{font-family:Courier,monospace;line-height:1}abbr{letter-spacing:.1em}a{box-shadow:inset 0 -2px var(--underline-color),0 2px var(--underline-color);color:inherit;text-decoration:none}a:hover{box-shadow:inset 0 -2px var(--underline-hover-color),0 2px var(--underline-hover-color)}figure{margin:1.5rem 0}figcaption{padding-top:.75rem;color:var(--meta-color);text-align:center;font-size:.83rem}figure.formula{display:flex;align-items:center}figure.formula svg{flex:1}figure.formula figcaption{padding:0 .5rem 0 1rem}.page{margin:0 auto;padding:1.5rem 0;padding-right:calc(980px * .3 - 1.5rem);min-width:320px;max-width:980px}.page__sidebar{display:flex;flex-direction:column;float:left;box-sizing:border-box;padding:0 1rem 0 1.5rem;width:30%}.page__content{box-sizing:border-box;margin-left:30%;padding:0 3rem 0 1rem}.page__header{text-align:center}.page__user-name{display:inline-block;margin-bottom:1.5rem;text-transform:none;font-size:2rem;line-height:3rem}.page__user-picture{display:block;margin:0 auto 1.5rem;height:9rem}.page__user-picture svg{width:100%;height:100%}.search-control[disabled],.search-hidden{display:none!important}.search-toggle{display:none;border:0;background:transparent;width:16px;height:16px;padding:3px 0 0;cursor:pointer;box-sizing:content-box}.search-input{margin:0 2rem 1rem 0;box-sizing:border-box;height:2rem;padding:0 .25rem;font-size:16px}.search-results__content,.search-results__header{text-align:center}.search-results__item{margin-bottom:1.5rem;text-align:left}.search-results__item span{color:var(--meta-color)}.post+.post{margin:3rem 0}.post__header{margin-bottom:0;text-align:center}.post__content p,.post__content ul{margin-top:0}.post__read-more{text-align:center;font-size:.92rem;font-style:italic}.highlight code{background-color:currentColor;color:var(--code-color);display:block;line-height:1.5;padding:0 1.5rem}.highlight .scrollable{padding:1.5rem 0}.highlight pre{margin:0}.scrollable{overflow:auto;position:relative}.scrollable--enabled{overflow:hidden}.scrollbar{position:absolute;background-color:rgba(0,0,0,.05);cursor:default;-webkit-tap-highlight-color:transparent}.scrollbar--active,.scrollbar:hover{background-color:rgba(0,0,0,.1)}.scrollbar--horizontal{height:8px;bottom:0}.post-comments{color:var(--meta-color);margin:3rem 0 1.5rem;text-align:center}.post-comments__icon{width:1.5rem;height:1.5rem;display:inline-block;vertical-align:middle;margin-right:.25rem}.post-footer,.post__meta{color:var(--meta-color);text-align:center}.post__meta{margin:.75rem 0 2.25rem;font-size:.83rem;line-height:1.5rem}.post__content-list li{margin-bottom:1.5rem}.responsive-image{position:relative;margin:1.5rem auto;width:100%}.responsive-image img{position:absolute;top:0;left:0;width:100%}.rss{position:relative}.rss svg{position:absolute;top:2px;left:110%;left:calc(100% + 4px)}@media (min-width:980px){@supports (width:calc(100%)){.responsive-image--wide{width:calc(100% + 3rem);transform:translateX(-1.5rem)}.responsive-image--wide figcaption{padding-right:1.5rem;padding-left:1.5rem}}.highlight code{padding:0;box-shadow:1.5rem 0 currentColor,-1.5rem 0 currentColor}}.post-special-archive{position:relative;font-size:1.5rem;line-height:1.5rem}.archive{padding:0;list-style:none}.archive__item{display:block;margin-bottom:1.5rem}.archive__date{color:var(--meta-color);float:left;padding-right:1rem;width:4rem;font-size:.92rem;text-align:right}.archive__header{margin-left:5rem}.tags{padding:0;list-style:none;text-align:center}.tags__item{display:inline-block;margin-bottom:1.5rem;font-size:1.16rem;line-height:1.5rem}.tags__item:after{content:"\a0\25aa\a0"}.tags__item:last-child:after{content:""}@media (max-width:1367px){ul{padding-left:1.5rem}.page{padding-top:0;padding-right:0;margin:auto;max-width:42rem}.page__sidebar{float:none;margin-bottom:2rem;padding-top:1.5rem;padding-left:1rem;width:auto;box-shadow:0 1px var(--underline-color)}.page__content{margin-left:auto;padding-right:1rem}.page__user-picture-story{display:flex;align-items:center;margin-bottom:1.5rem}.page__user-picture{flex-shrink:0;margin-bottom:0;padding-right:1rem;width:4.5rem;height:4.5rem}.page__user-name{display:none}.page__nav{order:-1;margin-top:0;padding-left:0;text-align:center}.search-toggle{display:inline-block;order:-2;align-self:flex-end;position:absolute}.search-input{display:none;margin-right:0}.search-input--visible{display:block}.page__nav li{display:inline-block}.page__nav li:after{content:"\a0\25aa\a0";font-size:1.16rem;line-height:1}.page__nav li:last-child:after{content:""}.archive__date,.archive__header{line-height:2rem}}@media (max-width:666px){html{font-size:14px}}@media (max-width:359px){html{font-size:12px}.rss svg{top:0}}.highlight pre{color:#485e76}.hljs-comment,.hljs-meta{color:#a5abb1}.hljs-strong{font-weight:700}.hljs-built_in,.hljs-keyword,.hljs-variable{color:#5e89b9}.hljs-string{color:#b85242}.hljs-subst{color:#485e76}</style><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="A practical introduction to Make as a front-end development build tool."><link rel="alternate" type="application/atom+xml" title="Feed" href="https://eprev.org/atom.xml"><link rel="canonical" href="https://eprev.org/2017/02/20/make-as-a-front-end-development-build-tool/"><meta property="og:url" content="https://eprev.org/2017/02/20/make-as-a-front-end-development-build-tool/"><meta property="og:title" content="Make as a front-end development build tool"><meta property="og:site_name" content="Anton Eprev"><meta property="og:type" content="article"><meta property="og:description" content="A practical introduction to Make as a front-end development build tool."><meta property="og:image" content="https://eprev.org/2017/02/20/make-as-a-front-end-development-build-tool/og-preview.png"><meta name="twitter:image" content="https://eprev.org/2017/02/20/make-as-a-front-end-development-build-tool/og-preview.png"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:creator" content="@eprev"><meta name="twitter:title" content="Make as a front-end development build tool"><meta name="twitter:description" content="A practical introduction to Make as a front-end development build tool."><script src="/assets-bundles/main-1c359df26855dfc33ec6b756cadaaef2.js" type="module" data-search-worker-href="/assets-bundles/search-worker-124534c5d865a6e41caaaea92ec3e35d.js"></script><body><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-12144011-2', {'siteSpeedSampleRate': 100});
ga('set', 'transport', 'beacon');
ga('send', 'pageview');
window.addEventListener('error', function(e) {
ga('send', 'event', 'JavaScript Error', e.message, e.filename ? (e.filename + ':' + e.lineno) : 'N/A', {nonInteraction: 1});
});
if (window.performance && document.hidden !== undefined) {
var prevTimeStamp = performance.now();
var timeOnPage = 0;
var accTimeOnPage = function () {
if (document.hidden) {
timeOnPage += Math.round(performance.now() - prevTimeStamp);
} else {
prevTimeStamp = performance.now();
}
};
document.addEventListener('visibilitychange', accTimeOnPage);
window.addEventListener('unload', function () {
accTimeOnPage();
ga('send', 'timing', 'Engagement', 'Time On Page', timeOnPage, {transport: 'beacon'});
});
}
document.body.addEventListener('click', (e) => {
const target = e.target.closest('[data-ga-on=click]');
if (target) {
const data = target.dataset;
ga('send', 'event', data.gaCategory, data.gaAction, data.gaLabel, data.gaValue);
}
});</script><div class="page"><div class="page__sidebar"><div class="page__user-picture-story"><a class="page__user-name" href="/">@eprev</a><div class="page__user-picture"><svg viewBox="0 0 484 570" xmlns="http://www.w3.org/2000/svg"><path d="m44 507v66h342v-66z" fill="#feffff"/><path d="m14 570.002v-41.002c0-27.756 37-40.998 37-40.998l80 69h23v13zm358-132.002h27c19.039 0 65.46-1.278 85 81v51h-112zm-112 118h33v14h-33z" fill="#ff2600"/><path d="m43 194v280c0 19.33 51.4265 83 87 83h172c49.101 0 85-65.652 85-83v-280c0-3.965-48.992-79-53-79h-239c-4.0083 0-52 79-52 79z" fill="#ffd400"/><path d="m388 272v-122c0-34.2-22.673-33.69-53-34 21.545.496 27-28.1304 27-43 0-14.3739.06-41.1217-29-55-28.559-13.87826-70 4-70 4s20.472 17.7913 34 51c-1.503 9.4174-9 4-9 4s-33.247-58.6438-108-66c-95.6977-9.41739-166.9752 3.791-179-11 19.5404 65.9217 40.9048 116.991 87 116-46.0952.991-46 34-46 34v61 61h32 32v-156c0 8.922 217 7 217 7v149c30.062-.496 65 0 65 0z" fill="#ff2600"/><path d="m422 344v-55c0-36.678-35.992-36-40-36h-15c-4.008 0-8 4.035-8 8v112c0 3.965 3.992 8 8 8h15c4.008 0 40-.322 40-37zm-418-55v55c0 36.678 35.9917 37 40 37h15c4.0083 0 8-4.035 8-8v-112c0-3.965-3.9917-8-8-8h-15c-4.0083 0-40-.678-40 36z" fill="#ffd400"/><path d="m154 437v17.017l117-.017v-17z" fill="#770b00" data-id="mouth"/><path d="m284 345c-25.553 0-47-21.722-47-47s21.447-46 47-46 47 20.722 47 46-21.447 47-47 47zm-143 0c-25.553 0-47-21.722-47-47s22.447-45.5 48-45.5 46 20.222 46 45.5-21.447 47-47 47z" fill="#feffff"/><circle cx="140" cy="298" r="24" fill="#aad6d7" data-id="right-eye" transform="translate(20, 0)"/><circle cx="283" cy="298" r="24" fill="#aad6d7" data-id="left-eye" transform="translate(20, 0)"/><path d="m142 375c-42.087 0-77-34.365-77-76s33.913-76 76-76c32.069 0 60.626 20.127 72 48 11.374-27.873 39.018-47.957 71.087-47.957 42.087 0 76.913 34.322 76.913 75.957s-34.913 76-77 76c-32.069 0-59.626-20.128-71-48-11.374 27.872-38.931 48-71 48zm-1-31c25.553 0 46.387-20.339 46.387-45.617 0-25.279-20.834-45.383-46.387-45.383s-46 20.722-46 46 20.447 45 46 45zm143 0c25.553 0 46-20.722 46-46s-20.447-45-46-45-46.509 20.104-46.509 45.383c0 25.278 20.956 45.617 46.509 45.617z" fill="#770b00"/></svg></div><div class="page__user-story">My name’s Anton Eprev and I’m a software developer working as front-end engineer at Booking.com in Amsterdam. Tinker with electronics and 3D printers in spare time. I’m on <a href="https://twitter.com/eprev">Twitter</a>, <a href="https://github.com/eprev">GitHub</a> and <a href="https://unsplash.com/@eprev">Unsplash</a>.</div></div><ul class="page__nav"><li><a href="/">Home</a></li><li><a href="/archive/">Archive</a></li><li><a href="/tags/">Tags</a></li><li><a href="/atom.xml" class="rss">Feed <svg viewBox="0 0 2048 2048" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path fill="#333333" d="M272.471 570.08V272.001h16c410.031 0 781.933 166.909 1051.34 436.402 269.336 269.426 436.174 641.389 436.174 1051.6v16h-314.992v-16c0-323.56-131.538-617.092-343.903-829.707-212.277-212.528-505.373-344.214-828.617-344.214h-16v-16z"/><path fill="#333333" d="M272.015 1070.06V771.981h16c272.262 0 519.128 110.832 697.96 289.753 178.832 178.923 289.575 425.934 289.575 698.269v16H960.102v-16c0-90.402-17.458-177.951-50.831-258.675-33.32-80.595-82.528-154.512-146.086-217.8l-.063-.063c-63.341-63.61-137.25-112.971-217.764-146.432-80.446-33.433-167.55-50.973-257.342-50.973h-16v-16z"/><path fill="#333333" d="M334.294 1413.49c38.385-38.288 91.32-62.061 149.555-62.061 58.608 0 111.582 23.705 149.961 61.9 38.531 38.346 62.327 91.268 62.327 149.443 0 58.492-23.713 111.332-62.13 149.57-38.401 38.22-91.457 61.806-150.158 61.806-58.326 0-111.345-23.651-149.75-61.969-38.318-38.227-62.083-90.999-62.083-149.407 0-58.092 23.848-110.946 62.278-149.282z"/></svg></a></li></ul><button disabled="disabled" class="search-toggle search-control" data-ga-on="click" data-ga-category="Click" data-ga-action="Search Button" aria-label="Search"><svg viewBox="0 0 56.966 56.966" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path fill="#333333" d="M55.146,51.887L41.588,37.786c3.486-4.144,5.396-9.358,5.396-14.786c0-12.682-10.318-23-23-23s-23,10.318-23,23 s10.318,23,23,23c4.761,0,9.298-1.436,13.177-4.162l13.661,14.208c0.571,0.593,1.339,0.92,2.162,0.92 c0.779,0,1.518-0.297,2.079-0.837C56.255,54.982,56.293,53.08,55.146,51.887z M23.984,6c9.374,0,17,7.626,17,17s-7.626,17-17,17 s-17-7.626-17-17S14.61,6,23.984,6z"/></svg></button> <input disabled="disabled" type="text" class="search-input search-control" placeholder="Search" data-ga-on="click" data-ga-category="Click" data-ga-action="Search Input"></div><div class="page__content"><div class="post"><h1 class="post__header">Make as a front-end development build tool</h1><div class="post__meta">February 20, 2017 ∙ 9 minutes read ∙ <a href="/tags/makefile/">makefile</a>, <a href="/tags/devops/">devops</a></div><div class="post__content"><blockquote class="epigraph"><p>Make is turning 40 in 2017.</p></blockquote><p>This is a practical introduction to Make as a front-end development build tool. I will give the basic understanding of how makefiles work and show how to get the most common front-end tasks done using Make. However I encourage you to read the <a href="http://www.gnu.org/software/make/manual/make.html">official manual</a> through.</p><p>Why even bother with Make? Make is a powerful tool which is not limited to building packages. You can use it for anything you do from copying files or running webpack to deploying your project. I use this <a href="https://raw.githubusercontent.com/eprev/eprev.org/df2e82563c2e444f8116dc4e9fe1f56dcdc56984/Makefile">makefile</a> to build and deploy this very web site. These are the tasks that it carries out for me:</p><ul><li>Running Jekyll</li><li>Watching for changes in JavaScript source files</li><li>Building JavaScript bundles</li><li>Minifying static assets (CSS, JavaScript and HTML)</li><li>Versioning static assets</li><li>Deploying the web site to GitHub Pages</li></ul><p>And that makefile is less than 80 lines of code!</p><h2>Makefile basics</h2><p>Any makefile consists of “rules”: build targets, their dependencies and series of commands (recipes) to build those targets:</p><figure class="highlight"><code><div class="scrollable"><pre>target …: dependency …
    command
    …</pre></div></code></figure><p><strong>Please note:</strong> each command must begin with a tab character.</p><p>Here’s a simple makefile:</p><figure class="highlight"><code><div class="scrollable"><pre><span class="hljs-section">dist/main.js: src/main.js</span>
    mkdir -p dist
    cp src/main.js dist/main.js</pre></div></code></figure><p>On the first line we have the <code>dist/main.js</code> target with the <code>src/main.js</code> file as the only dependency. In order to build this target, Make will execute <code>mkdir</code> and <code>cp</code> commands. The former creates the directory if it doesn’t exist and the later puts a copy of the source file to that directory.</p><p>To use this makefile to create the target file, type <code>make</code>:</p><figure class="highlight"><code><div class="scrollable"><pre><span class="hljs-meta">$</span><span class="bash"> make</span>
mkdir -p dist
cp src/main.js dist/main.js</pre></div></code></figure><p>If no dependencies have changed after the target was generated, <code>make</code> won’t update that target. That’s why if you run it twice in a row, <code>make</code> won’t copy any files on the second run:</p><figure class="highlight"><code><div class="scrollable"><pre><span class="hljs-meta">$</span><span class="bash"> make</span>
make: &#x27;dist/main.js&#x27; is up to date.</pre></div></code></figure><p>Anyway, it required quite a bit of typing just to copy a file. Our recipe can be improved by using <a href="https://www.gnu.org/software/make/manual/make.html#Automatic-Variables">automatic variables</a>:</p><figure class="highlight"><code><div class="scrollable"><pre><span class="hljs-section">dist/main.js: src/main.js</span>
    mkdir -p $(@D)
    cp <span class="hljs-variable">$&lt;</span> <span class="hljs-variable">$@</span></pre></div></code></figure><p>Where:</p><ul><li><code>$@</code> – The file name of the target.</li><li><code>$&lt;</code> – The file name of the first dependency.</li><li><code>$(@D)</code> – The directory part of the file name of the target.</li></ul><p>That’s better. Now, what if we have more than one JavaScript file to copy? We can replace our explicit rule with a <a href="https://www.gnu.org/software/make/manual/make.html#Pattern-Rules">pattern rule</a>:</p><figure class="highlight"><code><div class="scrollable"><pre><span class="hljs-section">dist/%.js: src/%.js</span>
    mkdir -p $(@D)
    cp <span class="hljs-variable">$&lt;</span> <span class="hljs-variable">$@</span></pre></div></code></figure><p>Where <code>%</code> in the target matches any non-empty substring, and <code>%</code> in the dependency represents the same matched substring in the target.</p><p>If you were to run <code>make</code> this time, it would fail:</p><figure class="highlight"><code><div class="scrollable"><pre><span class="hljs-meta">$</span><span class="bash"> make</span>
make: *** No targets.  Stop.</pre></div></code></figure><p>It doesn’t know which target it should be building now, since there’s no longer explicit rules in the makefile. You would need to pass the desired target name in the arguments:</p><figure class="highlight"><code><div class="scrollable"><pre><span class="hljs-meta">$</span><span class="bash"> make dist/main.js</span>
mkdir -p dist
cp src/main.js dist/main.js</pre></div></code></figure><p>This doesn’t seem handy though. Instead, we could define a new rule called <code>all</code> with the <code>dist/main.js</code> file as the dependency and an empty recipe:</p><figure class="highlight"><code><div class="scrollable"><pre><span class="hljs-section">all: dist/main.js</span>

<span class="hljs-section">dist/%.js: src/%.js</span>
    mkdir -p $(@D)
    cp <span class="hljs-variable">$&lt;</span> <span class="hljs-variable">$@</span></pre></div></code></figure><p>Now, <code>make</code> will start with the <code>all</code> target. In order to “build” it, it has to find the dependency file <code>dist/main.js</code>, and if the later doesn’t exist, it will look for a rule to create it.</p><p>But this doesn’t seem to be a scalable solution either. What if Make could actually find the existing files in the <code>src</code> directory and based on them create the list of dependencies for the <code>all</code> target? Now we’re getting somewhere:</p><figure class="highlight"><code><div class="scrollable"><pre><span class="hljs-section">all: $(subst src/,dist/,$(wildcard src/*.js))</span>

<span class="hljs-section">dist/%.js: src/%.js</span>
    mkdir -p $(@D)
    cp <span class="hljs-variable">$&lt;</span> <span class="hljs-variable">$@</span></pre></div></code></figure><p>Those <code>wildcard</code> and <code>subst</code> are Make’s <a href="https://www.gnu.org/software/make/manual/make.html#Functions">functions</a>. The former returns a space-separated list of names of existing files that match the given pattern <code>src/*.js</code>, and the later replaces <code>src/</code> with <code>dist/</code> in that list.</p><p>And finally, we could use <a href="https://www.gnu.org/software/make/manual/make.html#Using-Variables">variables</a> to store the directory names, so we won’t have to update rules in the makefile if the structure of our project changes:</p><figure class="highlight"><code><div class="scrollable"><pre>SRC_DIR  := src
DIST_DIR := dist

<span class="hljs-section">all: $(subst <span class="hljs-variable">$(SRC_DIR)</span>/,<span class="hljs-variable">$(DIST_DIR)</span>/,$(wildcard <span class="hljs-variable">$(SRC_DIR)</span>/*.js))</span>

<span class="hljs-variable">$(DIST_DIR)</span>/%.js: <span class="hljs-variable">$(SRC_DIR)</span>/%.js
    mkdir -p $(@D)
    cp <span class="hljs-variable">$&lt;</span> <span class="hljs-variable">$@</span></pre></div></code></figure><h2>Make by example</h2><p>In the next sections I will explain some parts of the <a href="https://raw.githubusercontent.com/eprev/eprev.org/df2e82563c2e444f8116dc4e9fe1f56dcdc56984/Makefile">makefile</a> that I use to build and deploy this web site. I hope these examples are good enough for you to get started.</p><h3>Building JavaScript bundles</h3><p>I keep JavaScript files in the <code>js</code> directory. All the files contained within the <code>js</code> directory are bundles, that may import other source files from the subdirectories. Basically, the folder structure looks like this:</p><figure class="highlight"><code><div class="scrollable"><pre>.
├── assets/
├── js/
│   ├── src/
│   │   ├── ga.js
│   │   └── polyfills.js
│   └── main.js
└── Makefile</pre></div></code></figure><p>The <code>js/main.js</code> file is used as the entry point for <a href="http://rollupjs.org/">Rollup</a> to create the resulting bundle in the <code>assets</code> directory. I have a target called <code>build-assets</code> in the makefile that does it:</p><figure class="highlight"><code><div class="scrollable"><pre>ROLLUP := ./node_modules/.bin/rollup
ROLLUPFLAGS := --format=iife --sourcemap

JS_DIRECTORY := js
ASSETS_DIRECTORY := assets
JS_ASSETS := <span class="hljs-variable">$(<span class="hljs-built_in">subst</span> <span class="hljs-variable">$(JS_DIRECTORY)</span>/,<span class="hljs-variable">$(ASSETS_DIRECTORY)</span>/,$(<span class="hljs-built_in">wildcard</span> <span class="hljs-variable">$(JS_DIRECTORY)</span>/*.js)</span>)

<span class="hljs-section">clean-assets:</span>
    rm -rf <span class="hljs-variable">$(ASSETS_DIRECTORY)</span>/*

<span class="hljs-variable">$(ASSETS_DIRECTORY)</span>/%.js: <span class="hljs-variable">$(JS_DIRECTORY)</span>/%.js
    <span class="hljs-variable">$(ROLLUP)</span> <span class="hljs-variable">$(ROLLUPFLAGS)</span> -i <span class="hljs-variable">$&lt;</span> -o <span class="hljs-variable">$@</span>

<span class="hljs-section">build-assets: clean-assets <span class="hljs-variable">$(JS_ASSETS)</span></span></pre></div></code></figure><p>This is very similar to what we have done earlier to copy multiple JavaScript files.</p><h3>Watching for changes</h3><p><a href="https://github.com/emcrisostomo/fswatch"><code>fswatch</code></a> is a cross-platform file change monitor that gets notified when the contents of the particular files or directories are modified. You can use <a href="https://brew.sh/">Homebrew</a> to install it:</p><figure class="highlight"><code><div class="scrollable"><pre><span class="hljs-meta">$</span><span class="bash"> brew install fswatch</span></pre></div></code></figure><p>I have the <code>watch</code> target in the makefile, which starts <code>fswatch</code> and will run <code>make build-assets</code> when any of JavaScript files changes:</p><figure class="highlight"><code><div class="scrollable"><pre><span class="hljs-section">watch:</span>
    fswatch -o <span class="hljs-variable">$(JS_DIRECTORY)</span> | xargs -n1 -I{} <span class="hljs-variable">$(MAKE)</span> build-assets</pre></div></code></figure><p>This command performs the following operations:</p><ul class="post__content-list"><li>The <code>fswatch -o js</code> command will start watching for file changes in the <code>js</code> directory. The <code>-o</code> option tells <code>fswatch</code> to batch change events.</li><li>The <code>xargs -n1</code> command will execute the <code>$(MAKE) build-assets</code> command each time <code>fswatch</code> detects a change.</li><li>The <code>-I{}</code> option will substitute occurrences of <code>{}</code> in the given command with the string from the standard input. Even though we don't have <code>{}</code> in the command, without this option <code>xargs</code> will execute <code>make</code> with two arguments (instead of one): <code>build-assets</code> and the string it gets from the standard input.</li></ul><p>To start watching for changes, type:</p><figure class="highlight"><code><div class="scrollable"><pre><span class="hljs-meta">$</span><span class="bash"> make watch</span></pre></div></code></figure><p>To stop, press <code>Ctrl-C</code>.</p><h3>Minifying static assets</h3><p>Here I use <a href="https://github.com/babel/babili">Babili</a> to minify ES6 JavaScript bundles after they are generated by <code>build-assets</code>:</p><figure class="highlight"><code><div class="scrollable"><pre>BABILI := ./node_modules/.bin/babili
BABILIFLAGS := --no-comments

<span class="hljs-section">compress-assets: build-assets</span>
    <span class="hljs-variable">$(BABILI)</span> <span class="hljs-variable">$(ASSETS_DIRECTORY)</span> -d <span class="hljs-variable">$(ASSETS_DIRECTORY)</span> <span class="hljs-variable">$(BABILIFLAGS)</span></pre></div></code></figure><p>The same way you can use, for instance, <a href="http://cssnano.co/">cssnano</a> and <a href="https://github.com/kangax/html-minifier">html-minifier</a> to compress CSS and HTML.</p><h3>Versioning static assets</h3><p>Caching is important, so is a strategy for breaking the cache and making the browsers download updated resources.</p><p>The popular approach is to include the hash of the file contents in its name, eg. <code>assets/main-a2f40c.js</code>. This way it guarantees the file name won't change during the building process if its contents remains the same.</p><p>If you choose this approach, you will have to generate the manifest file in order to reference those files in the HTML or CSS. And here is the <code>build-manifest</code> target in the makefile that does it:</p><figure class="highlight"><code><div class="scrollable"><pre>MANIFEST_FILE := _data/manifest.yml

<span class="hljs-section">clean-manifest:</span>
    rm -f <span class="hljs-variable">$(MANIFEST_FILE)</span>

<span class="hljs-section">build-manifest: clean-manifest compress-assets</span>
    @for filename in $$( find <span class="hljs-variable">$(ASSETS_DIRECTORY)</span> -type f -exec basename {} \; ); do \
        hash=$<span class="hljs-variable">$(md5 -q <span class="hljs-variable">$(ASSETS_DIRECTORY)</span>/$$filename)</span>; \
        hashed_filename=<span class="hljs-string">&quot;$${filename%%.*}-$$hash.$${filename#*.}&quot;</span>; \
        cp <span class="hljs-variable">$(ASSETS_DIRECTORY)</span>/$$filename <span class="hljs-variable">$(ASSETS_DIRECTORY)</span>/$$hashed_filename; \
        echo <span class="hljs-string">&quot;$$filename: $$hashed_filename&quot;</span> &gt;&gt; <span class="hljs-variable">$(MANIFEST_FILE)</span>; \
    done</pre></div></code></figure><p>Firstly, Make executes each line in a recipe separately. And if you need to write multi-line command, then you can use line continuations. Make also prints out each command before it gets executed, and the <code>@</code> character in the start of the line prevents the command from such echoing.</p><p>Secondly, the <code>$</code> character is used to reference variables in makefiles, so does the shell. And in order to get <code>$filename</code> passed to the shell, rather than having Make trying to find a variable called <code>filename</code>, we need to write <code>$$filename</code>.</p><p>Thus, this is actually what Make will pass to the shell (Bash) when running <code>build-manifest</code>:</p><figure class="highlight"><code><div class="scrollable"><pre><span class="hljs-keyword">for</span> filename <span class="hljs-keyword">in</span> $( find assets -<span class="hljs-built_in">type</span> f -<span class="hljs-built_in">exec</span> basename {} \; ); <span class="hljs-keyword">do</span> \
    <span class="hljs-built_in">hash</span>=$(md5 -q assets/<span class="hljs-variable">$filename</span>); \
    hashed_filename=<span class="hljs-string">&quot;<span class="hljs-variable">${filename%%.*}</span>-<span class="hljs-variable">$hash</span>.<span class="hljs-variable">${filename#*.}</span>&quot;</span>; \
    cp asstes/<span class="hljs-variable">$filename</span> assets/<span class="hljs-variable">$hashed_filename</span>; \
    <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;<span class="hljs-variable">$filename</span>: <span class="hljs-variable">$hashed_filename</span>&quot;</span> &gt;&gt; _data/manifest.yml; \
<span class="hljs-keyword">done</span></pre></div></code></figure><p>This command performs the following operations:</p><ul class="post__content-list"><li>The <code>find assets -type f -exec basename {} \;</code> command will find all files in the <code>assets</code> directory.</li><li>The <code>md5 -q assets/$filename</code> command will calculate a checksum for the given file.</li><li>The <code>${filename%%.*}</code> operation will delete the longest match of <code>.*</code> from the back of the file name. If <code>$filename</code> was containing <code>main.js.map</code>, it would keep the <code>main</code> part only.</li><li>The <code>${filename#*.}</code> operation will delete the shortest match of <code>*.</code> from the front of the file name. If <code>$filename</code> was containing <code>main.js.map</code>, it would keep the <code>js.map</code> part only.</li><li>The <code>echo &quot;…&quot; &gt;&gt; _data/manifest.yml</code> command will append a string containing both file names to the manifest file.</li></ul><p>Basically, for each file that it finds in the <code>assets</code> directory, it will calculate a checksum, make a copy of the file and generate the manifest file containing key-value pairs:</p><figure class="highlight"><code><div class="scrollable"><pre>main.js: main-a2f40c69875a90f46f961febe52d4989.js
…</pre></div></code></figure><p>This is how I use this information later in Jekyll to reference JavaScript bundles:</p><figure class="highlight"><code><div class="scrollable"><pre>{% if site.data.manifest %}
    &lt;script src=&quot;{{ site.url }}/assets/{{ site.data.manifest['main.js'] }}&quot;&gt;&lt;/srcipt&gt;
{% else %}
    &lt;script src=&quot;{{ site.url }}/assets/main.js&quot;&gt;&lt;/srcipt&gt;
{% endif %}</pre></div></code></figure><h3>Deploying to GitHub Pages</h3><p>I keep the source code of the web site in the <code>master</code> branch and the contents of the <code>_site</code> directory in the <code>gh-pages</code> branch. Thus, to publish a new version of the web site I just need to push changes in the <code>_site</code> directory to GitHub. To automate this I created a target called <code>deploy</code>:</p><figure class="highlight"><code><div class="scrollable"><pre><span class="hljs-section">build-deploy: build</span>
    …
    JEKYLL_ENV=production bundle exec jekyll build
    …

<span class="hljs-section">reset-site:</span>
    git --git-dir=_site/.git reset --hard origin/gh-pages
    git --git-dir=_site/.git pull origin gh-pages

<span class="hljs-section">deploy: reset-site build-deploy</span>
    git --git-dir=_site/.git add -A
    git --git-dir=_site/.git commit -m <span class="hljs-string">&quot;Deploy&quot;</span>
    git --git-dir=_site/.git push origin gh-pages</pre></div></code></figure><h2>Conclusion</h2><p>Make is a great cross-platform tool suitable for projects of different sizes and complexities. More powerful and expressive in a certain way than NPM scripts, Grunt or Gulp.</p><p>And I hope this article has sparked your interest in learning and getting out of your comfort zone as a front-end developer.</p></div></div><div class="post-comments" data-issue-id="18"><span class="post-comments__icon"><svg viewBox="0 0 26 26" xmlns="http://www.w3.org/2000/svg"><path fill="#888888" d="M 13 0.1875 C 6 0.1875 0.1875 5.25 0.1875 11.625 C 0.1875 14.621094 1.59375 17.257813 3.6875 19.28125 C 3.605469 20.441406 3.023438 21.132813 2.21875 21.8125 C 1.785156 22.175781 1.308594 22.515625 0.875 22.9375 C 0.441406 23.359375 0 23.929688 0 24.71875 C 0 25.175781 0.308594 25.574219 0.75 25.6875 C 2.628906 26.191406 4.648438 25.820313 6.5 25.15625 C 8.164063 24.558594 9.574219 23.671875 10.6875 22.8125 C 11.441406 22.9375 12.203125 23.03125 13 23.03125 C 20 23.03125 25.8125 17.996094 25.8125 11.625 C 25.8125 5.253906 20 0.1875 13 0.1875 Z M 13 2.1875 C 19.046875 2.1875 23.8125 6.476563 23.8125 11.625 C 23.8125 16.773438 19.046875 21.03125 13 21.03125 C 12.214844 21.03125 11.460938 20.984375 10.71875 20.84375 C 10.421875 20.773438 10.113281 20.84375 9.875 21.03125 C 8.972656 21.789063 7.457031 22.703125 5.84375 23.28125 C 4.851563 23.636719 3.84375 23.800781 2.90625 23.84375 C 3.117188 23.675781 3.28125 23.554688 3.53125 23.34375 C 4.539063 22.496094 5.75 21.128906 5.75 19.0625 C 5.75 18.773438 5.625 18.5 5.40625 18.3125 C 3.40625 16.585938 2.1875 14.234375 2.1875 11.625 C 2.1875 6.476563 6.953125 2.1875 13 2.1875 Z"/></svg> </span><span class="post-comments__text">Want to leave a comment on this? Visit <a href="https://github.com/eprev/eprev.org/issues/18" data-ga-on="click" data-ga-category="Click" data-ga-action="Comments" data-ga-label="/2017/02/20/make-as-a-front-end-development-build-tool/">the&#160;post’s&#160;issue&#160;page</a> on GitHub.</span></div><div class="post-footer"><a href="https://github.com/eprev/eprev.org/blob/master/source/posts/2017-02-20-make-as-a-front-end-development-build-tool/make-as-a-front-end-development-build-tool.md" data-ga-on="click" data-ga-category="Click" data-ga-action="Edit" data-ga-label="/2017/02/20/make-as-a-front-end-development-build-tool/">Edit</a> this post on GitHub.</div></div></div><script>!function(){window.counter="https://eprev_org.goatcounter.com/count";var e=document.createElement("script");e.async=1,e.src="//gc.zgo.at/count.js";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script></body></html>